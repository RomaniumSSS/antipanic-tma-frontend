# Тестирование фазы 5.2 — Страница деталей цели

## Что реализовано

### ✅ Компоненты (3 новых)

1. **ProgressBar.tsx** — универсальный прогресс-бар
   - 4 варианта высоты (sm/md/lg)
   - 4 цветовых схемы (blue/green/yellow/gray)
   - Анимация при активности
   - Label с процентами

2. **StageCard.tsx** — карточка этапа
   - Заголовок этапа с иконкой статуса
   - Диапазон дат (старт — конец)
   - Прогресс-бар с цветом по статусу
   - Подсветка активного этапа
   - Статус badge (В работе/Завершён/Ожидает)

3. **StepItem.tsx** — элемент шага
   - Заголовок шага с иконкой
   - Уровень сложности (Легко/Средне/Сложно)
   - Время выполнения (минуты)
   - XP награда
   - Плейсхолдер для кнопок действий (будет в 5.3)

### ✅ Страница деталей цели

**Роут**: `/goals/[id]`

**Секции**:
1. Header с кнопкой "Назад"
2. Карточка с информацией о цели:
   - Заголовок
   - Описание (если есть)
   - Статус (В работе/Выполнено/На паузе/Отменено)
   - Дни до дедлайна
   - Даты старта и дедлайна
3. Список этапов с прогресс-барами
4. Плейсхолдер для шагов текущего этапа (Фаза 5.3)

**UX фичи**:
- Haptic feedback при навигации
- Loading skeletons
- Error state с кнопкой возврата
- Demo mode для тестирования вне Telegram

### ✅ Навигация

- Клик по цели на главной странице → переход на `/goals/{id}`
- Кнопка "Назад" → `router.back()`
- Haptic feedback для всех кликов

---

## Как тестировать

### 1. Локальная разработка

```bash
cd tma-frontend
npm install
npm run dev
```

Откройте http://localhost:3000 в браузере:
- Увидите демо-режим с плейсхолдер данными
- Кликните на цель → должна открыться страница деталей

### 2. Тестирование в Telegram (production)

**Предварительные требования**:
- Фронтенд задеплоен на Vercel
- Бэкенд работает на Railway
- У пользователя есть хотя бы одна цель с этапами

**Шаги**:
1. Откройте бота в Telegram
2. Выполните `/app` или нажмите кнопку меню
3. На главной странице кликните на любую цель
4. Должна открыться страница деталей цели:
   ✅ Заголовок цели отображается
   ✅ Дни до дедлайна рассчитаны правильно
   ✅ Этапы отображаются с прогресс-барами
   ✅ Активный этап подсвечен синей рамкой
   ✅ Кнопка "Назад" работает
   ✅ Haptic feedback срабатывает при кликах

### 3. Edge cases для тестирования

**Тест 1: Цель без этапов**
- Ожидается: Плейсхолдер "Нет этапов"

**Тест 2: Цель с просроченным дедлайном**
- Ожидается: "Просрочено на X дн."

**Тест 3: Несуществующий ID цели**
- URL: `/goals/999999`
- Ожидается: Error state "Цель не найдена"

**Тест 4: Цель со статусом "completed"**
- Ожидается: Зелёный badge "Выполнено" + ✅

**Тест 5: Этап с прогрессом 100%**
- Ожидается: Зелёный прогресс-бар, badge "Завершён"

---

## API используемые

- `GET /api/goals/{id}` — детали цели (уже реализован)

**Response example**:
```json
{
  "id": 1,
  "title": "Выучить TypeScript",
  "description": "Освоить TypeScript для React разработки",
  "start_date": "2024-12-01",
  "deadline": "2025-01-15",
  "status": "active",
  "stages": [
    {
      "id": 1,
      "title": "Основы синтаксиса",
      "order": 0,
      "start_date": "2024-12-01",
      "end_date": "2024-12-15",
      "progress": 75,
      "status": "active"
    },
    {
      "id": 2,
      "title": "React + TypeScript",
      "order": 1,
      "start_date": "2024-12-16",
      "end_date": "2025-01-15",
      "progress": 0,
      "status": "pending"
    }
  ]
}
```

---

## Что НЕ реализовано (будет в 5.3)

- ❌ Отображение шагов текущего этапа (требует `GET /api/steps/today`)
- ❌ Кнопки "Сделал" / "Пропустить" для шагов
- ❌ Обновление статистики в реальном времени

---

## Коммит

```bash
cd tma-frontend
git add .
git commit -m "feat(tma): add goal detail page with stages (phase 5.2)

- Add ProgressBar, StageCard, StepItem components
- Implement /goals/[id] route
- Show stages with progress bars
- Highlight active stage
- Add navigation from home page
- Placeholder for steps section (phase 5.3)"
```

---

## Следующие шаги (Phase 5.3)

1. Реализовать backend endpoints:
   - `GET /api/steps/today`
   - `POST /api/steps/{id}/complete`
   - `POST /api/steps/{id}/skip`

2. Добавить секцию "Шаги на сегодня" на `/goals/[id]`

3. Реализовать кнопки действий в StepItem

4. Real-time обновление статистики после выполнения шага

